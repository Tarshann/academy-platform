{
  "query": "-- DM Conversations table\nCREATE TABLE IF NOT EXISTS `dmConversations` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  `lastMessageAt` timestamp,\n  CONSTRAINT `dmConversations_id` PRIMARY KEY(`id`)\n);\n\n-- DM Participants table\nCREATE TABLE IF NOT EXISTS `dmParticipants` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `conversationId` int NOT NULL,\n  `userId` int NOT NULL,\n  `lastReadAt` timestamp,\n  `isMuted` boolean NOT NULL DEFAULT false,\n  `mutedUntil` timestamp,\n  `isArchived` boolean NOT NULL DEFAULT false,\n  `joinedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `dmParticipants_id` PRIMARY KEY(`id`)\n);\n\n-- DM Messages table\nCREATE TABLE IF NOT EXISTS `dmMessages` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `conversationId` int NOT NULL,\n  `senderId` int NOT NULL,\n  `senderName` varchar(255) NOT NULL,\n  `content` text NOT NULL,\n  `isEdited` boolean NOT NULL DEFAULT false,\n  `isDeleted` boolean NOT NULL DEFAULT false,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `dmMessages_id` PRIMARY KEY(`id`)\n);\n\n-- DM Read Receipts table\nCREATE TABLE IF NOT EXISTS `dmReadReceipts` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `messageId` int NOT NULL,\n  `userId` int NOT NULL,\n  `readAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `dmReadReceipts_id` PRIMARY KEY(`id`)\n);\n\n-- User Blocks table\nCREATE TABLE IF NOT EXISTS `userBlocks` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `blockerId` int NOT NULL,\n  `blockedId` int NOT NULL,\n  `reason` text,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `userBlocks_id` PRIMARY KEY(`id`)\n);\n\n-- User Messaging Roles table\nCREATE TABLE IF NOT EXISTS `userMessagingRoles` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `messagingRole` enum('parent', 'athlete', 'coach', 'staff', 'admin') NOT NULL DEFAULT 'parent',\n  `canDmCoaches` boolean NOT NULL DEFAULT true,\n  `canDmParents` boolean NOT NULL DEFAULT false,\n  `canDmAthletes` boolean NOT NULL DEFAULT false,\n  `canBroadcast` boolean NOT NULL DEFAULT false,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `userMessagingRoles_id` PRIMARY KEY(`id`),\n  CONSTRAINT `userMessagingRoles_userId_unique` UNIQUE(`userId`)\n);\n\n-- Push Subscriptions table\nCREATE TABLE IF NOT EXISTS `pushSubscriptions` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `endpoint` text NOT NULL,\n  `p256dh` varchar(255) NOT NULL,\n  `auth` varchar(255) NOT NULL,\n  `userAgent` text,\n  `isActive` boolean NOT NULL DEFAULT true,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `pushSubscriptions_id` PRIMARY KEY(`id`)\n);\n\n-- Notification Settings table\nCREATE TABLE IF NOT EXISTS `notificationSettings` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `pushEnabled` boolean NOT NULL DEFAULT false,\n  `emailFallback` boolean NOT NULL DEFAULT true,\n  `dmNotifications` boolean NOT NULL DEFAULT true,\n  `channelNotifications` boolean NOT NULL DEFAULT true,\n  `mentionNotifications` boolean NOT NULL DEFAULT true,\n  `announcementNotifications` boolean NOT NULL DEFAULT true,\n  `quietHoursEnabled` boolean NOT NULL DEFAULT false,\n  `quietHoursStart` varchar(5),\n  `quietHoursEnd` varchar(5),\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `notificationSettings_id` PRIMARY KEY(`id`),\n  CONSTRAINT `notificationSettings_userId_unique` UNIQUE(`userId`)\n);\n\n-- Notification Logs table\nCREATE TABLE IF NOT EXISTS `notificationLogs` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `notificationType` enum('push', 'email') NOT NULL,\n  `title` varchar(255) NOT NULL,\n  `body` text,\n  `data` text,\n  `notificationStatus` enum('pending', 'sent', 'failed', 'clicked') NOT NULL DEFAULT 'pending',\n  `sentAt` timestamp,\n  `clickedAt` timestamp,\n  `errorMessage` text,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `notificationLogs_id` PRIMARY KEY(`id`)\n);",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user AcXERCaCsbgdFHD.root --database bbHXx7a7VbAs5icaZpy3GL --execute -- DM Conversations table\nCREATE TABLE IF NOT EXISTS `dmConversations` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  `lastMessageAt` timestamp,\n  CONSTRAINT `dmConversations_id` PRIMARY KEY(`id`)\n);\n\n-- DM Participants table\nCREATE TABLE IF NOT EXISTS `dmParticipants` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `conversationId` int NOT NULL,\n  `userId` int NOT NULL,\n  `lastReadAt` timestamp,\n  `isMuted` boolean NOT NULL DEFAULT false,\n  `mutedUntil` timestamp,\n  `isArchived` boolean NOT NULL DEFAULT false,\n  `joinedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `dmParticipants_id` PRIMARY KEY(`id`)\n);\n\n-- DM Messages table\nCREATE TABLE IF NOT EXISTS `dmMessages` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `conversationId` int NOT NULL,\n  `senderId` int NOT NULL,\n  `senderName` varchar(255) NOT NULL,\n  `content` text NOT NULL,\n  `isEdited` boolean NOT NULL DEFAULT false,\n  `isDeleted` boolean NOT NULL DEFAULT false,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `dmMessages_id` PRIMARY KEY(`id`)\n);\n\n-- DM Read Receipts table\nCREATE TABLE IF NOT EXISTS `dmReadReceipts` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `messageId` int NOT NULL,\n  `userId` int NOT NULL,\n  `readAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `dmReadReceipts_id` PRIMARY KEY(`id`)\n);\n\n-- User Blocks table\nCREATE TABLE IF NOT EXISTS `userBlocks` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `blockerId` int NOT NULL,\n  `blockedId` int NOT NULL,\n  `reason` text,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `userBlocks_id` PRIMARY KEY(`id`)\n);\n\n-- User Messaging Roles table\nCREATE TABLE IF NOT EXISTS `userMessagingRoles` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `messagingRole` enum('parent', 'athlete', 'coach', 'staff', 'admin') NOT NULL DEFAULT 'parent',\n  `canDmCoaches` boolean NOT NULL DEFAULT true,\n  `canDmParents` boolean NOT NULL DEFAULT false,\n  `canDmAthletes` boolean NOT NULL DEFAULT false,\n  `canBroadcast` boolean NOT NULL DEFAULT false,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `userMessagingRoles_id` PRIMARY KEY(`id`),\n  CONSTRAINT `userMessagingRoles_userId_unique` UNIQUE(`userId`)\n);\n\n-- Push Subscriptions table\nCREATE TABLE IF NOT EXISTS `pushSubscriptions` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `endpoint` text NOT NULL,\n  `p256dh` varchar(255) NOT NULL,\n  `auth` varchar(255) NOT NULL,\n  `userAgent` text,\n  `isActive` boolean NOT NULL DEFAULT true,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `pushSubscriptions_id` PRIMARY KEY(`id`)\n);\n\n-- Notification Settings table\nCREATE TABLE IF NOT EXISTS `notificationSettings` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `pushEnabled` boolean NOT NULL DEFAULT false,\n  `emailFallback` boolean NOT NULL DEFAULT true,\n  `dmNotifications` boolean NOT NULL DEFAULT true,\n  `channelNotifications` boolean NOT NULL DEFAULT true,\n  `mentionNotifications` boolean NOT NULL DEFAULT true,\n  `announcementNotifications` boolean NOT NULL DEFAULT true,\n  `quietHoursEnabled` boolean NOT NULL DEFAULT false,\n  `quietHoursStart` varchar(5),\n  `quietHoursEnd` varchar(5),\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `notificationSettings_id` PRIMARY KEY(`id`),\n  CONSTRAINT `notificationSettings_userId_unique` UNIQUE(`userId`)\n);\n\n-- Notification Logs table\nCREATE TABLE IF NOT EXISTS `notificationLogs` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `notificationType` enum('push', 'email') NOT NULL,\n  `title` varchar(255) NOT NULL,\n  `body` text,\n  `data` text,\n  `notificationStatus` enum('pending', 'sent', 'failed', 'clicked') NOT NULL DEFAULT 'pending',\n  `sentAt` timestamp,\n  `clickedAt` timestamp,\n  `errorMessage` text,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `notificationLogs_id` PRIMARY KEY(`id`)\n);",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 1595
}